App42_Push_Sample_Unity
=======================

# About Application

1. This application shows how can we integrate our Unity3D game with Push Notification using android Framework.
2. Once a game registered for Push Notification Unity3D game get Notification message accordingly.

# Running Sample

This is a sample Android Unity 3D app is made by using App42 back-end platform. It uses Push Notification of App42 platform.
Here are the few easy steps to run this sample app.

1. [Register] (https://apphq.shephertz.com/register) with App42 platform.
2. Create an app once you are on Quick start page after registration.
3. If you are already registered, login to [AppHQ] (http://apphq.shephertz.com) console and create an app from App Manager Tab.
4. To use PushNotification service in your application,create a new project in [Google API Console] (https://code.google.com/apis/console/b/0/?noredirect&pli=1).
5. Click on services option in Google console and enable Google Cloud Messaging for Android service.
6. Click on API Access tab and create a new server key for your application with blank server information.
7. Go to [AppHQ] (http://apphq.shephertz.com) console and click on Push Notification and select Android setting in Settings option.
8. Select your app and copy server key that is generated by using Google API console, and submit it.
9. Download the Unity project from [here] (https://github.com/shephertz/App42_Push_Sample_Unity/archive/master.zip) and open the PushSample.unity from your assets folder , it contains PushSample.cs & Constants.cs.
10. Open Constants.cs file in sample app and make these changes.

```
A. Change ApiKey and SecretKey that you have received in step 2 or 3 at line no 6 and 7.
B. Change GoogleProjectNo with your Google Project Number  at line no 8.
C. Change UserId with your username you want tp register for Push Notification at line no 9.
D. Change GameObjectName with your GameObject on which you have to receive Push Notification callback from Android e.g. Success app42Msg.
E. Change callBackMethod with your method name on which you have to receive Push Notificationcallback from Android e.g. Success.
```
11.Build your android apk.

__Test and verify Push Notification__
```
A. After registering for Push Notification go to AppHQ console and click on Push Notification and select application after selecting User tab.
B. Select desired user from registered UserList and click on Send Message Button.
C. Send appropriate message to user by clicking Send Button.
D. Now you will get same message on your android device and your callback Method of Unity3D.
```

__System Requirements:__
```
A. Unity 3D.
B. Android SDK with 4.0 API .
```

__Prior Checks:__ Before building android application please review following things :

1. Bundle Identifier* name should be same as your package name defined in AndroidMaifest.xml file. In this sample it is being used as com.shephertz.app42.unity.android.test</br>
2. You have attached PushSample.cs file on MainCamera.
3. You can also replace Push Notification icon with your icon in \Assets\plugins\Android\assets folder with same name and same type.

__Modifying Main Activity:__ This sample uses its own Main Activity however if you want to use your own Main Activity or other third party Main Activity in your game you have to make following changes in AndroidManifest.xml file available in Assets\plugins\Android folder.

1. Delete sampleAndroid.jar and put your jar file which contains  Main Activity</br>

2. Replace "com.shephertz.app42.unity.android.test.MainActivity" with your Launcher/Main Activity  in AndroidManifest.xml file.</br>
```
  <activity android:name="com.shephertz.app42.unity.android.test.MainActivity" >
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>
```
3. Change "com.shephertz.app42.unity.android.test.MainActivity" with your Activity on which you want to navigate when PushNotification is clicked by user.
```
  <meta-data android:name="onMessageOpen" android:value="com.shephertz.app42.unity.android.test.MainActivity" />
```
4. Modify AndroidManifest.xml file with your AndroidManifest.xml accordingly.


# Design Details:

__Push Registration:__ To use Notification message in your game you have to register your game for PushNotification
by calling this method in your main cs file. 

```
public void RegisterForPush(){
		 object[] googleProjectNo = new object[]{Constants.GoogleProjectNo};
          object[] unityParam = new object[]{Constants.CallBackMethod,Constants.GameObjectName,UnityRegistrationMethod};
          using (var actClass = new AndroidJavaClass("com.unity3d.player.UnityPlayer")) {
                playerActivityContext = actClass.GetStatic<AndroidJavaObject>("currentActivity");
		     using (var pluginClass = new AndroidJavaClass("com.shephertz.app42.android.pushservice.App42Service")) {
                if (pluginClass != null) {
                    testobj = pluginClass.CallStatic<AndroidJavaObject>("instance",playerActivityContext);
				    testobj.Call("setProjectNo",googleProjectNo);
                    testobj.Call("registerForNotification",unityParam);
                }
          	  }
            }
	}
```

__Send PushNotification to User using Unity App42 SDK :__ You can use this method written in PushSample..cs file.
 
```
	public void sendPushToUser(string userName,string msg){
		App42API.BuildPushNotificationService().SendPushMessageToUser(userName,msg,new Callback());
	}

```

__Send PushNotification to all users using Unity App42 SDK :__ You can use this method written in PushSample..cs file..
 
```
	 public void sendPushToAll(string msg){	
		 App42API.BuildPushNotificationService().SendPushMessageToAll(msg,new Callback());
        }

```

__Get Last Push Notification Message :__ You can use this method to getLast Push Notification message, written in PushSample..cs file..
 
```
	public void getLastMessage(){
		 object[] googleProjectNo = new object[]{Constants.GoogleProjectNo};
          object[] unityParam = new object[]{Constants.CallBackMethod,Constants.GameObjectName,UnityRegistrationMethod};
          using (var actClass = new AndroidJavaClass("com.unity3d.player.UnityPlayer")) {
                playerActivityContext = actClass.GetStatic<AndroidJavaObject>("currentActivity");
		     using (var pluginClass = new AndroidJavaClass("com.shephertz.app42.android.pushservice.App42Service")) {
                if (pluginClass != null) {
                    testobj = pluginClass.CallStatic<AndroidJavaObject>("instance",playerActivityContext);
				    testobj.Call("getLastMessage");
                }
          	  }
            }
	}

```
